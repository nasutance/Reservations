import{Q as I,j as y,k as V,f as n,o,b as i,a as P,w as v,F as k,g as Q,l as T,t as d,e as N,m as x,v as z,p as G,q as j,s as g}from"./app-Dyh8p-1e.js";import{_ as H}from"./DataTable-JgT4iivi.js";const J={key:0},K=["onUpdate:modelValue"],W=["onUpdate:modelValue"],X={key:1},Y={key:0},Z=["onUpdate:modelValue"],ee=["value"],te={key:1,class:"flex items-center gap-2"},se=["src"],ne={key:2,class:"text-gray-400"},oe={key:0},le=["value","onUpdate:modelValue"],ae={key:1},ie={key:0},ce={class:"text-sm block mb-1"},de={class:"grid grid-cols-2 gap-1"},re=["value","checked","onChange"],pe={key:1},ue={key:0},me={key:1},he={class:"flex flex-col gap-2 items-start mt-1"},_e=["onClick"],ye=["onClick"],fe=["onClick"],ve=["onClick"],ge={__name:"ArtistSection",setup(ke){const r=I(),M=y(r.props.types??[]),U=y(r.props.shows??[]);y(r.props.artistTypes??[]);const E=y(r.props.troupes??[]),b=y([]),p=y(new Set);V(()=>r.props.artists,S),V(()=>r.props.artistTypes,S),S();function S(){const t=r.props.artists??[],l=r.props.artistTypes??[];b.value=t.map(e=>{var $;const s=l.filter(c=>c.artist_id===e.id),a=s.map(c=>c.type_id),m=Object.fromEntries(s.map(c=>{var _;return[c.type_id,((_=c.shows)==null?void 0:_.map(f=>f.id))??[]]})),h={};for(const c of s){const _=($=c.type)==null?void 0:$.type;for(const f of c.shows??[])h[f.title]||(h[f.title]=[]),h[f.title].push(_)}const q=Object.entries(h).map(([c,_])=>`${c} (${_.join(", ")})`).join(" / ");return{id:e.id,firstname:e.firstname,lastname:e.lastname,selectedTypeIds:a,selectedShowTypeMap:m,showsText:q,troupe:e.troupe?{name:e.troupe.name,logo_url:e.troupe.logo_url}:null}})}function u(t){return p.value.has(t)}function A(t){u(t)?p.value.delete(t):p.value.add(t)}function L(){const t={id:`new-${Date.now()}`,firstname:"",lastname:"",selectedTypeIds:[],selectedShowTypeMap:{},isNew:!0};b.value.unshift(t),p.value.add(t.id)}function C(t){var l;return((l=M.value.find(e=>e.id===t))==null?void 0:l.type)??`Type ${t}`}function O(t){return t.map(C)}async function B(t){const l=t.isNew?"post":"put",e=t.isNew?"/artist":`/artist/${t.id}`;for(const s of t.selectedTypeIds)Array.isArray(t.selectedShowTypeMap[s])||(t.selectedShowTypeMap[s]=[]);t.selectedShowTypeMap=Object.fromEntries(Object.entries(t.selectedShowTypeMap).map(([s,a])=>[Number(s),a])),await g[l](e,{firstname:t.firstname,lastname:t.lastname,troupe_id:t.troupe_id,types:t.selectedTypeIds,shows:t.selectedShowTypeMap},{onSuccess:()=>{p.value.delete(t.id),g.reload({preserveScroll:!0})}})}function D(t){confirm("Supprimer définitivement cet artiste ?")&&g.delete(`/artist/${t}`,{preserveScroll:!0,onSuccess:()=>{p.value.delete(t),g.reload({preserveScroll:!0})}})}function F(t,l,e,s){Array.isArray(t.selectedShowTypeMap[l])||(t.selectedShowTypeMap[l]=[]);const a=t.selectedShowTypeMap[l];s.target.checked&&!a.includes(e)?a.push(e):!s.target.checked&&a.includes(e)&&(t.selectedShowTypeMap[l]=a.filter(m=>m!==e))}const w=["Artiste","Types","Troupe","Spectacles","Actions"],R=["fullname","types","troupe","shows","actions"];return(t,l)=>(o(),n("div",null,[l[1]||(l[1]=i("h3",{class:"text-xl font-semibold mb-4"},"Liste des artistes",-1)),i("button",{onClick:L},"➕ Ajouter un artiste"),P(H,{headers:w,fields:R,rows:b.value},{fullname:v(({row:e})=>[u(e.id)?(o(),n("div",J,[x(i("input",{"onUpdate:modelValue":s=>e.firstname=s,placeholder:"Prénom",class:"border px-2 py-1 rounded mr-1"},null,8,K),[[j,e.firstname]]),x(i("input",{"onUpdate:modelValue":s=>e.lastname=s,placeholder:"Nom",class:"border px-2 py-1 rounded"},null,8,W),[[j,e.lastname]])])):(o(),n("span",X,d(e.firstname)+" "+d(e.lastname),1))]),troupe:v(({row:e})=>[u(e.id)?(o(),n("div",Y,[x(i("select",{"onUpdate:modelValue":s=>e.troupe_id=s,class:"border px-2 py-1 rounded w-full"},[l[0]||(l[0]=i("option",{value:null},"— Aucune troupe —",-1)),(o(!0),n(k,null,T(E.value,s=>(o(),n("option",{key:s.id,value:s.id},d(s.name),9,ee))),128))],8,Z),[[G,e.troupe_id]])])):e.troupe?(o(),n("div",te,[i("img",{src:e.troupe.logo_url,class:"w-6 h-6 rounded-full object-cover",alt:"Logo"},null,8,se),i("span",null,d(e.troupe.name),1)])):(o(),n("span",ne,"—"))]),types:v(({row:e})=>[u(e.id)?(o(),n("div",oe,[(o(!0),n(k,null,T(M.value,s=>(o(),n("label",{key:s.id,class:"block text-sm"},[x(i("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":a=>e.selectedTypeIds=a,class:"mr-1"},null,8,le),[[z,e.selectedTypeIds]]),N(" "+d(s.type),1)]))),128))])):(o(),n("span",ae,d(O(e.selectedTypeIds).join(", ")||"—"),1))]),shows:v(({row:e})=>[u(e.id)?(o(),n("div",ie,[(o(!0),n(k,null,T(e.selectedTypeIds,s=>(o(),n("div",{key:s,class:"mb-2"},[i("strong",ce,d(C(s)),1),i("div",de,[(o(!0),n(k,null,T(U.value,a=>{var m;return o(),n("label",{key:`type-${s}-show-${a.id}`,class:"text-sm"},[i("input",{type:"checkbox",value:a.id,checked:(m=e.selectedShowTypeMap[s])==null?void 0:m.includes(a.id),onChange:h=>F(e,s,a.id,h),class:"mr-1"},null,40,re),N(" "+d(a.title),1)])}),128))])]))),128))])):(o(),n("span",pe,[e.showsText?(o(),n("span",ue,d(e.showsText),1)):(o(),n("span",me,"—"))]))]),actions:v(({row:e})=>[i("div",he,[u(e.id)?(o(),n(k,{key:1},[i("button",{class:"text-green-600 text-sm hover:underline",onClick:s=>B(e)}," 💾 Enregistrer ",8,ye),i("button",{class:"text-gray-600 text-sm hover:underline",onClick:s=>A(e.id)}," 🔄 Annuler ",8,fe),e.isNew?Q("",!0):(o(),n("button",{key:0,class:"text-red-600 text-sm hover:underline",onClick:s=>D(e.id)}," 🗑️ Supprimer ",8,ve))],64)):(o(),n("button",{key:0,class:"text-blue-600 text-sm hover:underline",onClick:s=>A(e.id)}," ✏️ Modifier ",8,_e))])]),_:1},8,["rows"])]))}};export{ge as default};
