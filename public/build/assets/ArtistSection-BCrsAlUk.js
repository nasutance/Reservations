import{Q as q,j as _,k as N,f as n,o as a,b as c,a as I,w as v,F as k,g as P,l as S,t as r,e as V,m as g,v as Q,p as j,q as T}from"./app-CexaMQVR.js";import{_ as z}from"./DataTable-CY3irTDa.js";const G={key:0},H=["onUpdate:modelValue"],J=["onUpdate:modelValue"],K={key:1},W={key:0},X=["value","onUpdate:modelValue"],Y={key:1},Z={key:0},ee={class:"text-sm block mb-1"},te={class:"grid grid-cols-2 gap-1"},se=["value","checked","onChange"],ne={key:1},ae={key:0},ie={key:1},le={class:"flex flex-col gap-2 items-start mt-1"},oe=["onClick"],ce=["onClick"],de=["onClick"],re=["onClick"],he={__name:"ArtistSection",setup(pe){const d=q(),M=_(d.props.types??[]),w=_(d.props.shows??[]);_(d.props.artistTypes??[]);const x=_([]),p=_(new Set);N(()=>d.props.artists,b),N(()=>d.props.artistTypes,b),b();function b(){const t=d.props.artists??[],l=d.props.artistTypes??[];x.value=t.map(e=>{var $;const s=l.filter(o=>o.artist_id===e.id),i=s.map(o=>o.type_id),u=Object.fromEntries(s.map(o=>{var h;return[o.type_id,((h=o.shows)==null?void 0:h.map(f=>f.id))??[]]})),m={};for(const o of s){const h=($=o.type)==null?void 0:$.type;for(const f of o.shows??[])m[f.title]||(m[f.title]=[]),m[f.title].push(h)}const R=Object.entries(m).map(([o,h])=>`${o} (${h.join(", ")})`).join(" / ");return{id:e.id,firstname:e.firstname,lastname:e.lastname,selectedTypeIds:i,selectedShowTypeMap:u,showsText:R}})}function y(t){return p.value.has(t)}function A(t){y(t)?p.value.delete(t):p.value.add(t)}function E(){const t={id:`new-${Date.now()}`,firstname:"",lastname:"",selectedTypeIds:[],selectedShowTypeMap:{},isNew:!0};x.value.unshift(t),p.value.add(t.id)}function C(t){var l;return((l=M.value.find(e=>e.id===t))==null?void 0:l.type)??`Type ${t}`}function U(t){return t.map(C)}async function L(t){const l=t.isNew?"post":"put",e=t.isNew?"/artist":`/artist/${t.id}`;for(const s of t.selectedTypeIds)Array.isArray(t.selectedShowTypeMap[s])||(t.selectedShowTypeMap[s]=[]);t.selectedShowTypeMap=Object.fromEntries(Object.entries(t.selectedShowTypeMap).map(([s,i])=>[Number(s),i])),await T[l](e,{firstname:t.firstname,lastname:t.lastname,types:t.selectedTypeIds,shows:t.selectedShowTypeMap},{onSuccess:()=>{p.value.delete(t.id),T.reload({preserveScroll:!0})}})}function O(t){confirm("Supprimer définitivement cet artiste ?")&&T.delete(`/artist/${t}`,{preserveScroll:!0,onSuccess:()=>{p.value.delete(t),T.reload({preserveScroll:!0})}})}function B(t,l,e,s){Array.isArray(t.selectedShowTypeMap[l])||(t.selectedShowTypeMap[l]=[]);const i=t.selectedShowTypeMap[l];s.target.checked&&!i.includes(e)?i.push(e):!s.target.checked&&i.includes(e)&&(t.selectedShowTypeMap[l]=i.filter(u=>u!==e))}const D=["Artiste","Types","Spectacles","Actions"],F=["fullname","types","shows","actions"];return(t,l)=>(a(),n("div",null,[l[0]||(l[0]=c("h3",{class:"text-xl font-semibold mb-4"},"Liste des artistes",-1)),c("button",{onClick:E},"➕ Ajouter un artiste"),I(z,{headers:D,fields:F,rows:x.value},{fullname:v(({row:e})=>[y(e.id)?(a(),n("div",G,[g(c("input",{"onUpdate:modelValue":s=>e.firstname=s,placeholder:"Prénom",class:"border px-2 py-1 rounded mr-1"},null,8,H),[[j,e.firstname]]),g(c("input",{"onUpdate:modelValue":s=>e.lastname=s,placeholder:"Nom",class:"border px-2 py-1 rounded"},null,8,J),[[j,e.lastname]])])):(a(),n("span",K,r(e.firstname)+" "+r(e.lastname),1))]),types:v(({row:e})=>[y(e.id)?(a(),n("div",W,[(a(!0),n(k,null,S(M.value,s=>(a(),n("label",{key:s.id,class:"block text-sm"},[g(c("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":i=>e.selectedTypeIds=i,class:"mr-1"},null,8,X),[[Q,e.selectedTypeIds]]),V(" "+r(s.type),1)]))),128))])):(a(),n("span",Y,r(U(e.selectedTypeIds).join(", ")||"—"),1))]),shows:v(({row:e})=>[y(e.id)?(a(),n("div",Z,[(a(!0),n(k,null,S(e.selectedTypeIds,s=>(a(),n("div",{key:s,class:"mb-2"},[c("strong",ee,r(C(s)),1),c("div",te,[(a(!0),n(k,null,S(w.value,i=>{var u;return a(),n("label",{key:`type-${s}-show-${i.id}`,class:"text-sm"},[c("input",{type:"checkbox",value:i.id,checked:(u=e.selectedShowTypeMap[s])==null?void 0:u.includes(i.id),onChange:m=>B(e,s,i.id,m),class:"mr-1"},null,40,se),V(" "+r(i.title),1)])}),128))])]))),128))])):(a(),n("span",ne,[e.showsText?(a(),n("span",ae,r(e.showsText),1)):(a(),n("span",ie,"—"))]))]),actions:v(({row:e})=>[c("div",le,[y(e.id)?(a(),n(k,{key:1},[c("button",{class:"text-green-600 text-sm hover:underline",onClick:s=>L(e)}," 💾 Enregistrer ",8,ce),c("button",{class:"text-gray-600 text-sm hover:underline",onClick:s=>A(e.id)}," 🔄 Annuler ",8,de),e.isNew?P("",!0):(a(),n("button",{key:0,class:"text-red-600 text-sm hover:underline",onClick:s=>O(e.id)}," 🗑️ Supprimer ",8,re))],64)):(a(),n("button",{key:0,class:"text-blue-600 text-sm hover:underline",onClick:s=>A(e.id)}," ✏️ Modifier ",8,oe))])]),_:1},8,["rows"])]))}};export{he as default};
