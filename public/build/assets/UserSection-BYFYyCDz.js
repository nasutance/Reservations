import{Q as E,j as p,k as S,f as n,o as l,b as i,a as R,w as d,F as x,l as $,m as u,e as N,v as F,t as r,p as _,q as g}from"./app-5sIL7s11.js";import{_ as I}from"./DataTable-DZ55UmEs.js";const A=["onUpdate:modelValue"],L={key:1},T=["onUpdate:modelValue"],q={key:1},B=["onUpdate:modelValue"],M={key:1},j=["onUpdate:modelValue"],D={key:1},K={key:0},O=["value","onUpdate:modelValue"],X={key:1},P={class:"flex flex-col gap-2 items-start mt-1"},Q=["onClick"],z=["onClick"],G=["onClick"],H=["onClick"],Z={__name:"UserSection",setup(J){const m=E(),y=p(m.props.roles??[]);p(m.props.users??[]);const h=p([]),f=p(new Set);k(),S(()=>m.props.users,k);function k(){const s=m.props.users??[];h.value=s.map(a=>{var e,t;return{id:a.id,firstname:a.firstname,lastname:a.lastname,email:a.email,langue:a.langue,selectedRoleIds:((e=a.roles)==null?void 0:e.map(c=>c.id))??[],role:((t=a.roles)==null?void 0:t.map(c=>c.role).join(", "))||"-"}})}function o(s){return f.value.has(s)}function v(s){o(s)?f.value.delete(s):f.value.add(s)}function U(s){g.put(`/users/${s.id}`,{firstname:s.firstname,lastname:s.lastname,email:s.email,langue:s.langue,roles:s.selectedRoleIds},{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},onSuccess:()=>{window.location.reload()},onError:a=>{console.error("Erreur de validation",a)}})}function b(s){confirm("Supprimer définitivement cet utilisateur ?")&&g.delete(`/users/${s}`,{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},onSuccess:()=>{window.location.reload()},onError:a=>{console.error("Erreur de suppression",a)}})}const V=["Prénom","Nom","Email","Langue","Rôle","Actions"],C=["firstname","lastname","email","langue","role","actions"];return(s,a)=>(l(),n("div",null,[a[0]||(a[0]=i("h3",{class:"text-xl font-semibold mb-4"},"Liste des utilisateurs",-1)),R(I,{headers:V,fields:C,rows:h.value},{firstname:d(({row:e})=>[o(e.id)?u((l(),n("input",{key:0,"onUpdate:modelValue":t=>e.firstname=t,class:"border px-2 py-1 rounded w-full"},null,8,A)),[[_,e.firstname]]):(l(),n("span",L,r(e.firstname),1))]),lastname:d(({row:e})=>[o(e.id)?u((l(),n("input",{key:0,"onUpdate:modelValue":t=>e.lastname=t,class:"border px-2 py-1 rounded w-full"},null,8,T)),[[_,e.lastname]]):(l(),n("span",q,r(e.lastname),1))]),email:d(({row:e})=>[o(e.id)?u((l(),n("input",{key:0,"onUpdate:modelValue":t=>e.email=t,class:"border px-2 py-1 rounded w-full"},null,8,B)),[[_,e.email]]):(l(),n("span",M,r(e.email),1))]),langue:d(({row:e})=>[o(e.id)?u((l(),n("input",{key:0,"onUpdate:modelValue":t=>e.langue=t,class:"border px-2 py-1 rounded w-full"},null,8,j)),[[_,e.langue]]):(l(),n("span",D,r(e.langue),1))]),role:d(({row:e})=>[o(e.id)?(l(),n("div",K,[(l(!0),n(x,null,$(y.value,t=>(l(),n("label",{key:t.id,class:"block text-sm"},[u(i("input",{type:"checkbox",value:t.id,"onUpdate:modelValue":c=>e.selectedRoleIds=c,class:"mr-1"},null,8,O),[[F,e.selectedRoleIds]]),N(" "+r(t.role),1)]))),128))])):(l(),n("span",X,r(e.role),1))]),actions:d(({row:e})=>[i("div",P,[o(e.id)?(l(),n(x,{key:1},[i("button",{class:"text-green-600 text-sm hover:underline",onClick:t=>U(e)},"💾 Enregistrer",8,z),i("button",{class:"text-gray-600 text-sm hover:underline",onClick:t=>v(e.id)},"🔄 Annuler",8,G),i("button",{class:"text-red-600 text-sm hover:underline",onClick:t=>b(e.id)},"🗑️ Supprimer",8,H)],64)):(l(),n("button",{key:0,class:"text-blue-600 text-sm hover:underline",onClick:t=>v(e.id)}," ✏️ Modifier ",8,Q))])]),_:1},8,["rows"])]))}};export{Z as default};
