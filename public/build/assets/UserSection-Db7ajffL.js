import{Q as E,j as p,k as S,f as n,o as l,b as i,a as $,w as d,F as x,l as I,m as u,e as R,v as L,t as r,p as _,q as g}from"./app-CJIZQ8yX.js";import{_ as N}from"./DataTable-DX8Ds6QZ.js";const B=["onUpdate:modelValue"],F={key:1},M=["onUpdate:modelValue"],j={key:1},A=["onUpdate:modelValue"],D={key:1},T=["onUpdate:modelValue"],q={key:1},P={key:0},Q=["value","onUpdate:modelValue"],z={key:1},G={class:"flex flex-col gap-2 items-start mt-1"},H=["onClick"],J=["onClick"],K=["onClick"],O=["onClick"],Z={__name:"UserSection",setup(W){const m=E(),y=p(m.props.roles??[]);p(m.props.users??[]);const h=p([]),f=p(new Set);k(),S(()=>m.props.users,k);function k(){const t=m.props.users??[];h.value=t.map(a=>{var e,s;return{id:a.id,firstname:a.firstname,lastname:a.lastname,email:a.email,langue:a.langue,selectedRoleIds:((e=a.roles)==null?void 0:e.map(c=>c.id))??[],role:((s=a.roles)==null?void 0:s.map(c=>c.role).join(", "))||"-"}})}function o(t){return f.value.has(t)}function v(t){o(t)?f.value.delete(t):f.value.add(t)}function U(t){g.put(`/users/${t.id}`,{firstname:t.firstname,lastname:t.lastname,email:t.email,langue:t.langue,roles:t.selectedRoleIds},{onSuccess:()=>{window.location.reload()},onError:a=>{console.error("Erreur de validation",a)}})}function b(t){confirm("Supprimer définitivement cet utilisateur ?")&&g.delete(`/users/${t}`,{onSuccess:()=>{window.location.reload()},onError:a=>{console.error("Erreur de suppression",a)}})}const V=["Prénom","Nom","Email","Langue","Rôle","Actions"],C=["firstname","lastname","email","langue","role","actions"];return(t,a)=>(l(),n("div",null,[a[0]||(a[0]=i("h3",{class:"text-xl font-semibold mb-4"},"Liste des utilisateurs",-1)),$(N,{headers:V,fields:C,rows:h.value},{firstname:d(({row:e})=>[o(e.id)?u((l(),n("input",{key:0,"onUpdate:modelValue":s=>e.firstname=s,class:"border px-2 py-1 rounded w-full"},null,8,B)),[[_,e.firstname]]):(l(),n("span",F,r(e.firstname),1))]),lastname:d(({row:e})=>[o(e.id)?u((l(),n("input",{key:0,"onUpdate:modelValue":s=>e.lastname=s,class:"border px-2 py-1 rounded w-full"},null,8,M)),[[_,e.lastname]]):(l(),n("span",j,r(e.lastname),1))]),email:d(({row:e})=>[o(e.id)?u((l(),n("input",{key:0,"onUpdate:modelValue":s=>e.email=s,class:"border px-2 py-1 rounded w-full"},null,8,A)),[[_,e.email]]):(l(),n("span",D,r(e.email),1))]),langue:d(({row:e})=>[o(e.id)?u((l(),n("input",{key:0,"onUpdate:modelValue":s=>e.langue=s,class:"border px-2 py-1 rounded w-full"},null,8,T)),[[_,e.langue]]):(l(),n("span",q,r(e.langue),1))]),role:d(({row:e})=>[o(e.id)?(l(),n("div",P,[(l(!0),n(x,null,I(y.value,s=>(l(),n("label",{key:s.id,class:"block text-sm"},[u(i("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":c=>e.selectedRoleIds=c,class:"mr-1"},null,8,Q),[[L,e.selectedRoleIds]]),R(" "+r(s.role),1)]))),128))])):(l(),n("span",z,r(e.role),1))]),actions:d(({row:e})=>[i("div",G,[o(e.id)?(l(),n(x,{key:1},[i("button",{class:"text-green-600 text-sm hover:underline",onClick:s=>U(e)},"💾 Enregistrer",8,J),i("button",{class:"text-gray-600 text-sm hover:underline",onClick:s=>v(e.id)},"🔄 Annuler",8,K),i("button",{class:"text-red-600 text-sm hover:underline",onClick:s=>b(e.id)},"🗑️ Supprimer",8,O)],64)):(l(),n("button",{key:0,class:"text-blue-600 text-sm hover:underline",onClick:s=>v(e.id)}," ✏️ Modifier ",8,H))])]),_:1},8,["rows"])]))}};export{Z as default};
