import{Q as g,h as C,j as $,f as s,o as l,b as m,a as E,w as d,g as x,t as i,F as I,l as N,u as U,m as c,e as R,s as F,x as p,q as _}from"./app-pR54vJex.js";import{_ as B}from"./DataTable-dhz1t69T.js";function L(){const f=g().props.users??[];return{formattedUsers:C(()=>f.map(n=>({id:n.id,firstname:n.firstname,lastname:n.lastname,email:n.email,langue:n.langue,role:n.roles.length>0?n.roles.map(r=>r.role).join(", "):"-",selectedRoleIds:n.roles.map(r=>r.id)})))}}const M=["onUpdate:modelValue"],j={key:1},A=["onUpdate:modelValue"],D={key:1},T=["onUpdate:modelValue"],q={key:1},P=["onUpdate:modelValue"],Q={key:1},z={key:0},G=["value","onUpdate:modelValue"],H={key:1},J={class:"flex gap-2 items-center"},K=["onClick"],O=["onClick"],W=["onClick"],Z={__name:"UserSection",setup(f){const h=g().props.roles??[],{formattedUsers:n}=L(),r=["Prénom","Nom","Email","Langue","Rôle","Actions"],v=["firstname","lastname","email","langue","role","actions"],u=$(new Set);function o(t){return u.value.has(t)}function y(t){o(t)?u.value.delete(t):u.value.add(t)}function b(t){_.put(`/users/${t.id}`,{firstname:t.firstname,lastname:t.lastname,email:t.email,langue:t.langue,roles:t.selectedRoleIds},{onSuccess:()=>{u.value.delete(t.id),_.reload({preserveScroll:!0})}})}function V(t){confirm("Supprimer définitivement cet utilisateur ?")&&_.delete(`/users/${t}`,{preserveScroll:!0,onSuccess:()=>{u.value.delete(t),_.reload({preserveScroll:!0})}})}return(t,k)=>(l(),s("div",null,[k[0]||(k[0]=m("h3",{class:"text-xl font-semibold mb-4"},"Liste des utilisateurs",-1)),E(B,{headers:r,fields:v,rows:U(n)},{firstname:d(({row:e})=>[o(e.id)?c((l(),s("input",{key:0,"onUpdate:modelValue":a=>e.firstname=a,class:"border px-2 py-1 rounded w-full"},null,8,M)),[[p,e.firstname]]):(l(),s("span",j,i(e.firstname),1))]),lastname:d(({row:e})=>[o(e.id)?c((l(),s("input",{key:0,"onUpdate:modelValue":a=>e.lastname=a,class:"border px-2 py-1 rounded w-full"},null,8,A)),[[p,e.lastname]]):(l(),s("span",D,i(e.lastname),1))]),email:d(({row:e})=>[o(e.id)?c((l(),s("input",{key:0,"onUpdate:modelValue":a=>e.email=a,class:"border px-2 py-1 rounded w-full"},null,8,T)),[[p,e.email]]):(l(),s("span",q,i(e.email),1))]),langue:d(({row:e})=>[o(e.id)?c((l(),s("input",{key:0,"onUpdate:modelValue":a=>e.langue=a,class:"border px-2 py-1 rounded w-full"},null,8,P)),[[p,e.langue]]):(l(),s("span",Q,i(e.langue),1))]),role:d(({row:e})=>[o(e.id)?(l(),s("div",z,[(l(!0),s(I,null,N(U(h),a=>(l(),s("label",{key:a.id,class:"block text-sm"},[c(m("input",{type:"checkbox",value:a.id,"onUpdate:modelValue":S=>e.selectedRoleIds=S,class:"mr-1"},null,8,G),[[F,e.selectedRoleIds]]),R(" "+i(a.role),1)]))),128))])):(l(),s("span",H,i(e.role),1))]),actions:d(({row:e})=>[m("div",J,[m("button",{onClick:a=>y(e.id),class:"text-sm text-blue-600"},i(o(e.id)?"Annuler":"✏️ Modifier"),9,K),o(e.id)?(l(),s("button",{key:0,onClick:a=>b(e),class:"text-sm text-green-600"}," 💾 Enregistrer ",8,O)):x("",!0),o(e.id)?(l(),s("button",{key:1,onClick:a=>V(e.id),class:"text-sm text-red-500 ml-2",title:"Supprimer l’utilisateur"}," ❌ ",8,W)):x("",!0)])]),_:1},8,["rows"])]))}};export{Z as default};
