import{Q as R,j as m,k as w,f as n,o,b as l,a as q,w as f,F as v,g as P,l as S,t as r,m as k,e as M,v as N,p as U,q as x}from"./app-BMjlmMSH.js";import{_ as Q}from"./DataTable-B0UdSOJv.js";const z={key:0},G=["onUpdate:modelValue"],H=["onUpdate:modelValue"],J={key:1},K={key:0},W=["value","onUpdate:modelValue"],X={key:1},Y={key:0},Z={class:"text-sm block mb-1"},ee={class:"grid grid-cols-2 gap-1"},te=["value","onUpdate:modelValue"],se={key:1},ne={key:0},oe={key:1},ae={class:"flex flex-col gap-2 items-start mt-1"},le=["onClick"],ie=["onClick"],de=["onClick"],ce=["onClick"],me={__name:"ArtistSection",setup(re){const d=R(),$=m(d.props.types??[]),j=m(d.props.shows??[]);m(d.props.artists??[]),m(d.props.artistTypes??[]);const T=m([]),p=m(new Set);w(()=>d.props.artists,b),w(()=>d.props.artistTypes,b),b();function b(){const t=d.props.artists??[],i=d.props.artistTypes??[];T.value=t.map(e=>{var V;const s=i.filter(a=>a.artist_id===e.id),c=s.map(a=>a.type_id),g=Object.fromEntries(s.map(a=>{var u;return[a.type_id,((u=a.shows)==null?void 0:u.map(_=>_.id))??[]]})),y={};for(const a of s){const u=(V=a.type)==null?void 0:V.type;for(const _ of a.shows??[])y[_.title]||(y[_.title]=[]),y[_.title].push(u)}const O=Object.entries(y).map(([a,u])=>`${a} (${u.join(", ")})`).join(" / ");return{id:e.id,firstname:e.firstname,lastname:e.lastname,selectedTypeIds:c,selectedShowTypeMap:g,showsText:O}})}function h(t){return p.value.has(t)}function A(t){h(t)?p.value.delete(t):p.value.add(t)}function E(){const t={id:`new-${Date.now()}`,firstname:"",lastname:"",selectedTypeIds:[],selectedShowTypeMap:{},isNew:!0};T.value.unshift(t),p.value.add(t.id)}function C(t){var i;return((i=$.value.find(e=>e.id===t))==null?void 0:i.type)??`Type ${t}`}function I(t){return t.map(C)}async function L(t){const i=t.isNew?"post":"put",e=t.isNew?"/artist":`/artist/${t.id}`;await x[i](e,{firstname:t.firstname,lastname:t.lastname,types:t.selectedTypeIds,shows:t.selectedShowTypeMap},{onSuccess:()=>{p.value.delete(t.id),x.reload({preserveScroll:!0})}})}function B(t){confirm("Supprimer définitivement cet artiste ?")&&x.delete(`/artist/${t}`,{preserveScroll:!0,onSuccess:()=>{p.value.delete(t),x.reload({preserveScroll:!0})}})}const D=["Artiste","Types","Spectacles","Actions"],F=["fullname","types","shows","actions"];return(t,i)=>(o(),n("div",null,[i[0]||(i[0]=l("h3",{class:"text-xl font-semibold mb-4"},"Liste des artistes",-1)),l("button",{onClick:E},"➕ Ajouter un artiste"),q(Q,{headers:D,fields:F,rows:T.value},{fullname:f(({row:e})=>[h(e.id)?(o(),n("div",z,[k(l("input",{"onUpdate:modelValue":s=>e.firstname=s,placeholder:"Prénom",class:"border px-2 py-1 rounded mr-1"},null,8,G),[[U,e.firstname]]),k(l("input",{"onUpdate:modelValue":s=>e.lastname=s,placeholder:"Nom",class:"border px-2 py-1 rounded"},null,8,H),[[U,e.lastname]])])):(o(),n("span",J,r(e.firstname)+" "+r(e.lastname),1))]),types:f(({row:e})=>[h(e.id)?(o(),n("div",K,[(o(!0),n(v,null,S($.value,s=>(o(),n("label",{key:s.id,class:"block text-sm"},[k(l("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":c=>e.selectedTypeIds=c,class:"mr-1"},null,8,W),[[N,e.selectedTypeIds]]),M(" "+r(s.type),1)]))),128))])):(o(),n("span",X,r(I(e.selectedTypeIds).join(", ")||"—"),1))]),shows:f(({row:e})=>[h(e.id)?(o(),n("div",Y,[(o(!0),n(v,null,S(e.selectedTypeIds,s=>(o(),n("div",{key:s,class:"mb-2"},[l("strong",Z,r(C(s)),1),l("div",ee,[(o(!0),n(v,null,S(j.value,c=>(o(),n("label",{key:`type-${s}-show-${c.id}`,class:"text-sm"},[k(l("input",{type:"checkbox",value:c.id,"onUpdate:modelValue":g=>e.selectedShowTypeMap[s]=g,class:"mr-1"},null,8,te),[[N,e.selectedShowTypeMap[s]]]),M(" "+r(c.title),1)]))),128))])]))),128))])):(o(),n("span",se,[e.showsText?(o(),n("span",ne,r(e.showsText),1)):(o(),n("span",oe,"—"))]))]),actions:f(({row:e})=>[l("div",ae,[h(e.id)?(o(),n(v,{key:1},[l("button",{class:"text-green-600 text-sm hover:underline",onClick:s=>L(e)}," 💾 Enregistrer ",8,ie),l("button",{class:"text-gray-600 text-sm hover:underline",onClick:s=>A(e.id)}," 🔄 Annuler ",8,de),e.isNew?P("",!0):(o(),n("button",{key:0,class:"text-red-600 text-sm hover:underline",onClick:s=>B(e.id)}," 🗑️ Supprimer ",8,ce))],64)):(o(),n("button",{key:0,class:"text-blue-600 text-sm hover:underline",onClick:s=>A(e.id)}," ✏️ Modifier ",8,le))])]),_:1},8,["rows"])]))}};export{me as default};
