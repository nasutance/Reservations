import{Q as U,j as u,k as D,f as s,o,b as p,a as E,w as _,g as y,t as c,m as f,F as g,l as w,s as b,p as L,u as A,q as h}from"./app-C7L2AEoC.js";import{f as B}from"./formatDate-D984MnE_.js";import{_ as F}from"./DataTable-DFNUlY3K.js";const M=["onUpdate:modelValue"],j={key:1},q=["onUpdate:modelValue"],H=["value"],I={key:1},Q=["onUpdate:modelValue"],T=["value"],z={key:1},G={class:"flex gap-2 items-center"},J=["onClick"],K=["onClick"],O=["onClick"],Z={__name:"RepresentationSection",setup(P){const r=U(),v=u(r.props.locations??[]),k=u(r.props.shows??[]);u(r.props.representations??[]);const m=u([]),d=u(new Set);x(),D(()=>r.props.representations,x);function x(){const t=r.props.representations??[];m.value=t.map(n=>({...n,location_id:n.location_id,show_id:n.show_id}))}function a(t){return d.value.has(t)}function S(t){a(t)?d.value.delete(t):d.value.add(t)}function C(){var n,e;const t={id:`new-${Date.now()}`,schedule:"",location_id:((n=v.value[0])==null?void 0:n.id)??null,show_id:((e=k.value[0])==null?void 0:e.id)??null,isNew:!0};m.value.unshift(t),d.value.add(t.id)}function V(t){const n=t.isNew?"post":"put",e=t.isNew?"/representation":`/representation/${t.id}`;h[n](e,{schedule:t.schedule,location_id:t.location_id,show_id:t.show_id},{onSuccess:()=>{d.value.delete(t.id),h.reload({preserveScroll:!0})}})}function N(t){confirm("Supprimer d√©finitivement cette repr√©sentation ?")&&h.delete(`/representation/${t}`,{preserveScroll:!0,onSuccess:()=>{d.value.delete(t),h.reload({preserveScroll:!0})}})}const R=["Date & Heure","Lieu","Spectacle","Actions"],$=["schedule","location","show","actions"];return(t,n)=>(o(),s("div",null,[n[0]||(n[0]=p("h3",{class:"text-xl font-semibold mb-4"},"Liste des repr√©sentations",-1)),p("button",{onClick:C},"‚ûï Ajouter une repr√©sentation"),E(F,{headers:R,fields:$,rows:m.value},{schedule:_(({row:e})=>[a(e.id)?f((o(),s("input",{key:0,type:"datetime-local","onUpdate:modelValue":l=>e.schedule=l,class:"border px-2 py-1 rounded w-full"},null,8,M)),[[L,e.schedule]]):(o(),s("span",j,c(A(B)(e.schedule,{time:!0})),1))]),location:_(({row:e})=>{var l;return[a(e.id)?f((o(),s("select",{key:0,"onUpdate:modelValue":i=>e.location_id=i,class:"border px-2 py-1 rounded w-full"},[(o(!0),s(g,null,w(v.value,i=>(o(),s("option",{key:i.id,value:i.id},c(i.designation),9,H))),128))],8,q)),[[b,e.location_id]]):(o(),s("span",I,c(((l=e.location)==null?void 0:l.designation)??"‚Äî"),1))]}),show:_(({row:e})=>{var l;return[a(e.id)?f((o(),s("select",{key:0,"onUpdate:modelValue":i=>e.show_id=i,class:"border px-2 py-1 rounded w-full"},[(o(!0),s(g,null,w(k.value,i=>(o(),s("option",{key:i.id,value:i.id},c(i.title),9,T))),128))],8,Q)),[[b,e.show_id]]):(o(),s("span",z,c(((l=e.show)==null?void 0:l.title)??"‚Äî"),1))]}),actions:_(({row:e})=>[p("div",G,[p("button",{onClick:l=>S(e.id),class:"text-sm text-blue-600"},c(a(e.id)?"Annuler":"‚úèÔ∏è Modifier"),9,J),a(e.id)?(o(),s("button",{key:0,onClick:l=>V(e),class:"text-sm text-green-600"}," üíæ Enregistrer ",8,K)):y("",!0),a(e.id)&&!e.isNew?(o(),s("button",{key:1,onClick:l=>N(e.id),class:"text-sm text-red-500 ml-2"}," ‚ùå ",8,O)):y("",!0)])]),_:1},8,["rows"])]))}};export{Z as default};
