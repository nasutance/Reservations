import{Q as R,j as y,k as C,f as n,o,b as l,a as q,w as f,F as v,g as P,l as b,t as r,e as w,m as g,v as Q,p as N,q as k,h as z}from"./app-ZwplyGN_.js";import{_ as G}from"./DataTable-CYyiOuEP.js";const H={key:0},J=["onUpdate:modelValue"],K=["onUpdate:modelValue"],W={key:1},X={key:0},Y=["value","onUpdate:modelValue"],Z={key:1},ee={key:0},te={class:"text-sm block mb-1"},se={class:"grid grid-cols-2 gap-1"},ne=["value","v-model"],oe={key:1},ae={key:0},ie={key:1},le={class:"flex flex-col gap-2 items-start mt-1"},de=["onClick"],ce=["onClick"],re=["onClick"],pe=["onClick"],ye={__name:"ArtistSection",setup(ue){const d=R(),S=y(d.props.types??[]),V=y(d.props.shows??[]);y(d.props.artistTypes??[]);const T=y([]),p=y(new Set);C(()=>d.props.artists,x),C(()=>d.props.artistTypes,x),x();function x(){const e=d.props.artists??[],a=d.props.artistTypes??[];T.value=e.map(t=>{var $;const s=a.filter(i=>i.artist_id===t.id),c=s.map(i=>i.type_id),F=Object.fromEntries(s.map(i=>{var u;return[i.type_id,((u=i.shows)==null?void 0:u.map(h=>h.id))??[]]})),_={};for(const i of s){const u=($=i.type)==null?void 0:$.type;for(const h of i.shows??[])_[h.title]||(_[h.title]=[]),_[h.title].push(u)}const O=Object.entries(_).map(([i,u])=>`${i} (${u.join(", ")})`).join(" / ");return{id:t.id,firstname:t.firstname,lastname:t.lastname,selectedTypeIds:c,selectedShowTypeMap:F,showsText:O}})}function m(e){return p.value.has(e)}function A(e){m(e)?p.value.delete(e):p.value.add(e)}function j(){const e={id:`new-${Date.now()}`,firstname:"",lastname:"",selectedTypeIds:[],selectedShowTypeMap:{},isNew:!0};T.value.unshift(e),p.value.add(e.id)}function M(e){var a;return((a=S.value.find(t=>t.id===e))==null?void 0:a.type)??`Type ${e}`}function U(e){return e.map(M)}function E(e,a){return z({get(){return Array.isArray(e.selectedShowTypeMap[a])||(e.selectedShowTypeMap[a]=[]),e.selectedShowTypeMap[a]},set(t){e.selectedShowTypeMap[a]=t}})}async function I(e){const a=e.isNew?"post":"put",t=e.isNew?"/artist":`/artist/${e.id}`;for(const s of e.selectedTypeIds)Array.isArray(e.selectedShowTypeMap[s])||(e.selectedShowTypeMap[s]=[]);await k[a](t,{firstname:e.firstname,lastname:e.lastname,types:e.selectedTypeIds,shows:e.selectedShowTypeMap},{onSuccess:()=>{p.value.delete(e.id),k.reload({preserveScroll:!0})}})}function L(e){confirm("Supprimer définitivement cet artiste ?")&&k.delete(`/artist/${e}`,{preserveScroll:!0,onSuccess:()=>{p.value.delete(e),k.reload({preserveScroll:!0})}})}const B=["Artiste","Types","Spectacles","Actions"],D=["fullname","types","shows","actions"];return(e,a)=>(o(),n("div",null,[a[0]||(a[0]=l("h3",{class:"text-xl font-semibold mb-4"},"Liste des artistes",-1)),l("button",{onClick:j},"➕ Ajouter un artiste"),q(G,{headers:B,fields:D,rows:T.value},{fullname:f(({row:t})=>[m(t.id)?(o(),n("div",H,[g(l("input",{"onUpdate:modelValue":s=>t.firstname=s,placeholder:"Prénom",class:"border px-2 py-1 rounded mr-1"},null,8,J),[[N,t.firstname]]),g(l("input",{"onUpdate:modelValue":s=>t.lastname=s,placeholder:"Nom",class:"border px-2 py-1 rounded"},null,8,K),[[N,t.lastname]])])):(o(),n("span",W,r(t.firstname)+" "+r(t.lastname),1))]),types:f(({row:t})=>[m(t.id)?(o(),n("div",X,[(o(!0),n(v,null,b(S.value,s=>(o(),n("label",{key:s.id,class:"block text-sm"},[g(l("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":c=>t.selectedTypeIds=c,class:"mr-1"},null,8,Y),[[Q,t.selectedTypeIds]]),w(" "+r(s.type),1)]))),128))])):(o(),n("span",Z,r(U(t.selectedTypeIds).join(", ")||"—"),1))]),shows:f(({row:t})=>[m(t.id)?(o(),n("div",ee,[(o(!0),n(v,null,b(t.selectedTypeIds,s=>(o(),n("div",{key:s,class:"mb-2"},[l("strong",te,r(M(s)),1),l("div",se,[(o(!0),n(v,null,b(V.value,c=>(o(),n("label",{key:`type-${s}-show-${c.id}`,class:"text-sm"},[l("input",{type:"checkbox",value:c.id,"v-model":E(t,s),class:"mr-1"},null,8,ne),w(" "+r(c.title),1)]))),128))])]))),128))])):(o(),n("span",oe,[t.showsText?(o(),n("span",ae,r(t.showsText),1)):(o(),n("span",ie,"—"))]))]),actions:f(({row:t})=>[l("div",le,[m(t.id)?(o(),n(v,{key:1},[l("button",{class:"text-green-600 text-sm hover:underline",onClick:s=>I(t)}," 💾 Enregistrer ",8,ce),l("button",{class:"text-gray-600 text-sm hover:underline",onClick:s=>A(t.id)}," 🔄 Annuler ",8,re),t.isNew?P("",!0):(o(),n("button",{key:0,class:"text-red-600 text-sm hover:underline",onClick:s=>L(t.id)}," 🗑️ Supprimer ",8,pe))],64)):(o(),n("button",{key:0,class:"text-blue-600 text-sm hover:underline",onClick:s=>A(t.id)}," ✏️ Modifier ",8,de))])]),_:1},8,["rows"])]))}};export{ye as default};
