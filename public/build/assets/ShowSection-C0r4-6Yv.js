import{Q as k,h as T,j as $,f as o,o as n,b as i,g as B,t as r,r as R,a as D,w as u,F as x,l as y,e as S,u as g,m as v,s as j,p as q,x as C,q as V}from"./app-pR54vJex.js";import{_ as O}from"./DataTable-dhz1t69T.js";import{f as P}from"./formatDate-D984MnE_.js";function A(){const f=k().props.shows??[],c=k().props.representations??[];return{formattedShows:T(()=>f.map(a=>{const _=c.filter(p=>p.show_id===a.id).map(p=>({...p,location:p.location||null}));return{id:a.id,title:a.title,description:a.description,duration:a.duration?`${a.duration}`:"-",bookable:!!a.bookable,representations:_}}))}}const I={key:0,class:"mt-2"},Q={__name:"ToggleDetails",props:{openLabel:{type:String,default:"Voir"},closeLabel:{type:String,default:"Masquer"}},setup(f){const c=$(!1);function b(){c.value=!c.value}return(a,_)=>(n(),o("div",null,[i("button",{onClick:b,class:"p-2 rounded text-grey hover:underline transition"},r(c.value?f.closeLabel:f.openLabel),1),c.value?(n(),o("div",I,[R(a.$slots,"default")])):B("",!0)]))}},z={class:"flex gap-4 mb-4"},G={key:0},H=["onUpdate:modelValue"],J={key:1},K={key:0},W=["onUpdate:modelValue"],X={key:1},Y={key:0},Z=["onUpdate:modelValue"],ee={key:1},te={class:"flex justify-center items-center h-full"},se=["onUpdate:modelValue"],oe={key:1},ne={key:0,class:"flex flex-col gap-2"},ie=["value","onUpdate:modelValue"],le={key:1,class:"text-sm text-gray-700 list-disc pl-4 mb-1"},ae={class:"flex justify-center items-center h-full"},re={class:"text-sm text-gray-700 list-disc pl-4 mb-1"},de={class:"flex flex-col gap-2 items-start mt-1"},ce=["onClick"],ue=["onClick"],pe=["onClick"],me=["onClick"],be={__name:"ShowSection",setup(f){const{formattedShows:c}=A(),b=["Titre","Description","Durée","Réservable","Tarification","Représentations","Actions"],a=["title","description","duration","bookable","prices","representations","actions"],_=k().props.prices??[],p=k().props.priceShow??[],m=$({}),d=$({});c.value.forEach(t=>{m.value[t.id]=p.filter(l=>l.show_id===t.id).map(l=>l.price_id)});function U(t){const l=p.filter(e=>e.show_id===t).map(e=>e.price_id);return _.filter(e=>l.includes(e.id))}function w(t){d.value[t]=!0,m.value[t]||(m.value[t]=[])}function F(t){d.value[t]=!1}function L(t){V.put(`/show/${t.id}`,{title:t.title,description:t.description,duration:t.duration,bookable:Number(t.bookable),price_ids:m.value[t.id]},{onSuccess:()=>{d.value[t.id]=!1,window.location.reload()}})}function N(t){confirm("Supprimer définitivement ce spectacle ?")&&V.delete(`/show/${t}`,{preserveScroll:!0,onSuccess:()=>{d.value[t]=!1,window.location.reload()}})}function E(){window.open(route("shows.export"),"_blank")}function M(t){const l=t.target.files[0];if(!l)return;const e=new FormData;e.append("csv_file",l),V.post(route("shows.import"),e,{forceFormData:!0,onSuccess:()=>{window.location.reload()}})}return(t,l)=>(n(),o("div",null,[l[3]||(l[3]=i("h3",{class:"text-xl font-semibold mb-4"},"Liste des spectacles",-1)),i("div",z,[i("button",{onClick:E,class:"text-sm text-blue-600 hover:underline"}," 📤Exporter en CSV "),i("input",{type:"file",ref:"csvFile",onChange:M,accept:".csv",class:"hidden"},null,544),i("button",{onClick:l[0]||(l[0]=e=>t.$refs.csvFile.click()),class:"text-sm text-blue-600 hover:underline"}," 📥Importer un CSV ")]),D(O,{headers:b,fields:a,rows:g(c)},{title:u(({row:e})=>[d.value[e.id]?(n(),o("div",G,[v(i("input",{"onUpdate:modelValue":s=>e.title=s,class:"border px-2 py-1 rounded text-sm w-full"},null,8,H),[[C,e.title]])])):(n(),o("span",J,r(e.title),1))]),description:u(({row:e})=>[d.value[e.id]?(n(),o("div",K,[v(i("textarea",{"onUpdate:modelValue":s=>e.description=s,class:"border px-2 py-1 rounded text-sm w-full",rows:"3"},null,8,W),[[C,e.description]])])):(n(),o("span",X,r(e.description),1))]),duration:u(({row:e})=>[d.value[e.id]?(n(),o("div",Y,[v(i("input",{type:"number","onUpdate:modelValue":s=>e.duration=s,min:"1",class:"border px-2 py-1 rounded text-sm w-24"},null,8,Z),[[C,e.duration]])])):(n(),o("span",ee,r(e.duration)+" '",1))]),bookable:u(({row:e})=>[i("div",te,[d.value[e.id]?v((n(),o("select",{key:0,"onUpdate:modelValue":s=>e.bookable=s,class:"border px-2 py-1 rounded text-sm"},l[1]||(l[1]=[i("option",{value:1},"Oui",-1),i("option",{value:0},"Non",-1)]),8,se)),[[q,e.bookable]]):(n(),o("span",oe,r(e.bookable?"Oui":"Non"),1))])]),prices:u(({row:e})=>[d.value[e.id]?(n(),o("div",ne,[(n(!0),o(x,null,y(g(_),s=>(n(),o("label",{key:s.id,class:"flex items-center gap-2 text-sm"},[v(i("input",{type:"checkbox",value:s.id,"onUpdate:modelValue":h=>m.value[e.id]=h,class:"accent-blue-600"},null,8,ie),[[j,m.value[e.id]]]),S(" "+r(s.description)+" — "+r(s.price)+"€ ",1)]))),128))])):(n(),o("ul",le,[(n(!0),o(x,null,y(U(e.id),s=>(n(),o("li",{key:s.id},r(s.description)+" — "+r(s.price)+"€ ",1))),128))]))]),representations:u(({row:e})=>[i("div",ae,[D(Q,{openLabel:"Détails",closeLabel:"Masquer"},{default:u(()=>[i("ul",re,[(n(!0),o(x,null,y(e.representations,s=>{var h;return n(),o("li",{key:s.id},[S(r(g(P)(s.schedule,{time:!0,seconds:!1})),1),l[2]||(l[2]=i("br",null,null,-1)),S(" "+r(((h=s.location)==null?void 0:h.designation)||"-"),1)])}),128))])]),_:2},1024)])]),actions:u(({row:e})=>[i("div",de,[d.value[e.id]?(n(),o(x,{key:1},[i("button",{class:"text-green-600 text-sm hover:underline",onClick:s=>L(e)}," ✅Enregistrer ",8,ue),i("button",{class:"text-gray-600 text-sm hover:underline",onClick:s=>F(e.id)}," 🔄Annuler ",8,pe),i("button",{class:"text-red-600 text-sm hover:underline",onClick:s=>N(e.id)}," 🗑️Supprimer ",8,me)],64)):(n(),o("button",{key:0,class:"text-blue-600 text-sm hover:underline",onClick:s=>w(e.id)}," ✏️ Modifier ",8,ce))])]),_:1},8,["rows"])]))}};export{be as default};
