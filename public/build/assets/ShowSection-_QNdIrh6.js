import{j as d,f as o,o as n,b as l,g as j,t as r,r as q,Q as A,k as D,a as U,w as u,F as x,l as y,e as S,u as O,m,v as P,s as I,p as g,q as v}from"./app-CPfZOMTh.js";import{_ as Q}from"./DataTable-D-yL1Qps.js";import{f as z}from"./formatDate-D984MnE_.js";const G={key:0,class:"mt-2"},H={__name:"ToggleDetails",props:{openLabel:{type:String,default:"Voir"},closeLabel:{type:String,default:"Masquer"}},setup(k){const a=d(!1);function f(){a.value=!a.value}return(_,h)=>(n(),o("div",null,[l("button",{onClick:f,class:"p-2 rounded text-grey hover:underline transition"},r(a.value?k.closeLabel:k.openLabel),1),a.value?(n(),o("div",G,[q(_.$slots,"default")])):j("",!0)]))}},J={class:"flex gap-4 mb-4"},K={key:0},W=["onUpdate:modelValue"],X={key:1},Y={key:0},Z=["onUpdate:modelValue"],ee={key:1},te={key:0},se=["onUpdate:modelValue"],oe={key:1},ne={class:"flex justify-center items-center h-full"},le=["onUpdate:modelValue"],ie={key:1},ae={key:0,class:"flex flex-col gap-2"},re=["value","onUpdate:modelValue"],ce={key:1,class:"text-sm text-gray-700 list-disc pl-4 mb-1"},de={class:"flex justify-center items-center h-full"},ue={class:"text-sm text-gray-700 list-disc pl-4 mb-1"},pe={class:"flex flex-col gap-2 items-start mt-1"},ve=["onClick"],me=["onClick"],fe=["onClick"],_e=["onClick"],ke={__name:"ShowSection",setup(k){const a=A();d(a.props.shows??[]),d(a.props.representations??[]);const f=d(a.props.prices??[]),_=d(a.props.priceShow??[]),h=d([]),p=d({}),c=d({});C(),V(),D(()=>a.props.shows,C),D(()=>a.props.priceShow,V);function C(){const s=a.props.shows??[],i=a.props.representations??[];h.value=s.map(e=>({...e,duration:e.duration??"",bookable:!!e.bookable,representations:i.filter(t=>t.show_id===e.id)}))}function V(){const s={},i=a.props.priceShow??[];h.value.forEach(e=>{s[e.id]=i.filter(t=>t.show_id===e.id).map(t=>t.price_id)}),_.value=[...i],p.value=s}function L(s){const i=_.value.filter(e=>e.show_id===s).map(e=>e.price_id);return f.value.filter(e=>i.includes(e.id))}function w(s){c.value[s]=!0,p.value[s]||(p.value[s]=[])}function F(s){c.value[s]=!1}function N(s){v.put(`/show/${s.id}`,{title:s.title,description:s.description,duration:s.duration,bookable:Number(s.bookable),price_ids:p.value[s.id]},{onSuccess:()=>{c.value[s.id]=!1,v.reload({preserveScroll:!0})}})}function E(s){confirm("Supprimer définitivement ce spectacle ?")&&v.delete(`/show/${s}`,{preserveScroll:!0,onSuccess:()=>{c.value[s]=!1,v.reload({preserveScroll:!0})}})}function M(){window.open(route("shows.export"),"_blank")}function T(s){const i=s.target.files[0];if(!i)return;const e=new FormData;e.append("csv_file",i),v.post(route("shows.import"),e,{forceFormData:!0,onSuccess:()=>v.reload()})}const $=d(null),B=["Titre","Description","Durée","Réservable","Tarification","Représentations","Actions"],R=["title","description","duration","bookable","prices","representations","actions"];return(s,i)=>(n(),o("div",null,[i[3]||(i[3]=l("h3",{class:"text-xl font-semibold mb-4"},"Liste des spectacles",-1)),l("div",J,[l("button",{onClick:M,class:"text-sm text-blue-600 hover:underline"},"📤Exporter en CSV"),l("input",{type:"file",ref_key:"csvFile",ref:$,onChange:T,accept:".csv",class:"hidden"},null,544),l("button",{onClick:i[0]||(i[0]=e=>$.value.click()),class:"text-sm text-blue-600 hover:underline"},"📥Importer un CSV")]),U(Q,{headers:B,fields:R,rows:h.value},{title:u(({row:e})=>[c.value[e.id]?(n(),o("div",K,[m(l("input",{"onUpdate:modelValue":t=>e.title=t,class:"border px-2 py-1 rounded text-sm w-full"},null,8,W),[[g,e.title]])])):(n(),o("span",X,r(e.title),1))]),description:u(({row:e})=>[c.value[e.id]?(n(),o("div",Y,[m(l("textarea",{"onUpdate:modelValue":t=>e.description=t,class:"border px-2 py-1 rounded text-sm w-full",rows:"3"},null,8,Z),[[g,e.description]])])):(n(),o("span",ee,r(e.description),1))]),duration:u(({row:e})=>[c.value[e.id]?(n(),o("div",te,[m(l("input",{type:"number","onUpdate:modelValue":t=>e.duration=t,min:"1",class:"border px-2 py-1 rounded text-sm w-24"},null,8,se),[[g,e.duration]])])):(n(),o("span",oe,r(e.duration)+" '",1))]),bookable:u(({row:e})=>[l("div",ne,[c.value[e.id]?m((n(),o("select",{key:0,"onUpdate:modelValue":t=>e.bookable=t,class:"border px-2 py-1 rounded text-sm"},i[1]||(i[1]=[l("option",{value:1},"Oui",-1),l("option",{value:0},"Non",-1)]),8,le)),[[I,e.bookable]]):(n(),o("span",ie,r(e.bookable?"Oui":"Non"),1))])]),prices:u(({row:e})=>[c.value[e.id]?(n(),o("div",ae,[(n(!0),o(x,null,y(f.value,t=>(n(),o("label",{key:t.id,class:"flex items-center gap-2 text-sm"},[m(l("input",{type:"checkbox",value:t.id,"onUpdate:modelValue":b=>p.value[e.id]=b,class:"accent-blue-600"},null,8,re),[[P,p.value[e.id]]]),S(" "+r(t.description)+" "+r(t.price)+"€ ",1)]))),128))])):(n(),o("ul",ce,[(n(!0),o(x,null,y(L(e.id),t=>(n(),o("li",{key:t.id},r(t.description)+" "+r(t.price)+"€ ",1))),128))]))]),representations:u(({row:e})=>[l("div",de,[U(H,{openLabel:"Détails",closeLabel:"Masquer"},{default:u(()=>[l("ul",ue,[(n(!0),o(x,null,y(e.representations,t=>{var b;return n(),o("li",{key:t.id},[S(r(O(z)(t.schedule,{time:!0,seconds:!1})),1),i[2]||(i[2]=l("br",null,null,-1)),S(" "+r(((b=t.location)==null?void 0:b.designation)||"-"),1)])}),128))])]),_:2},1024)])]),actions:u(({row:e})=>[l("div",pe,[c.value[e.id]?(n(),o(x,{key:1},[l("button",{class:"text-green-600 text-sm hover:underline",onClick:t=>N(e)}," ✅Enregistrer ",8,me),l("button",{class:"text-gray-600 text-sm hover:underline",onClick:t=>F(e.id)}," 🔄Annuler ",8,fe),l("button",{class:"text-red-600 text-sm hover:underline",onClick:t=>E(e.id)}," 🗑️Supprimer ",8,_e)],64)):(n(),o("button",{key:0,class:"text-blue-600 text-sm hover:underline",onClick:t=>w(e.id)}," ✏️ Modifier ",8,ve))])]),_:1},8,["rows"])]))}};export{ke as default};
