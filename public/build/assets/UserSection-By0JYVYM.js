import{j as g,B as E,f as r,o as s,b as l,t as v,F as h,l as x,m as C,e as I,v as V,p as N,r as U,g as D,q as $,Q as F,h as K,c as L}from"./app-BMjlmMSH.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"p-6 max-w-screen-xl mx-auto"},O={class:"text-2xl font-semibold mb-6"},T={class:"flex justify-center"},q={class:"min-w-[1100px] w-full border rounded shadow text-sm"},P={class:"bg-gray-100"},Q={key:0},z={key:0},G=["value","onUpdate:modelValue"],H=["onUpdate:modelValue","onBlur"],J={key:1},W={class:"border px-4 py-2 align-top whitespace-nowrap"},X={key:0,class:"flex gap-2"},Y=["onClick"],Z=["onClick"],ee={key:1,class:"flex gap-2"},te=["onClick"],ne=["onClick"],oe={__name:"CrudSection",props:{title:String,columns:Array,resource:String,defaultItem:Object,formatItem:Function,extraActions:Object,relations:Object},setup(p){const i=p,a=g([]),m=g(new Set),_=g({});async function f(){try{const e=await axios.get(`/${i.resource}`);a.value=i.formatItem?e.data.map(i.formatItem):e.data}catch(e){console.error(e)}}function c(){var n;const e={...i.defaultItem};a.value.unshift(e),S(e),(n=i.extraActions)!=null&&n.afterAdd&&i.extraActions.afterAdd(e)}function b(e){const n=a.value[e],t=!n.id,d=`/${i.resource}${t?"":"/"+n.id}`;$[t?"post":"put"](d,n,{preserveScroll:!0,onSuccess:()=>{m.value.delete(n.id),f()},onError:u=>console.error("Save error",u)})}function k(e){const n=a.value[e];if(!n.id){a.value.splice(e,1);return}confirm("Supprimer cet élément ?")&&$.delete(`/${i.resource}/${n.id}`,{preserveScroll:!0,onSuccess:()=>f()})}function y(e,n){if(i.relations&&i.relations[n]){const t=i.relations[n].find(d=>d.id===e);return t?t.label:e}return e}function A(e,n){return Array.isArray(e)?n.filter(t=>e.includes(t.id)).map(t=>t.label).join(", "):""}function S(e){m.value.add(e.id??e),_.value[e.id??e]={...e}}function j(e){const n=e.id??e,t=_.value[n];if(t){const d=a.value.findIndex(o=>(o.id??o)===n);a.value[d]={...t}}m.value.delete(n)}function w(e){return m.value.has(e.id??e)}function re(e){}return E(f),(e,n)=>(s(),r("section",R,[l("h2",O,v(p.title),1),l("div",{class:"mb-4"},[l("button",{onClick:c,class:"bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded"}," + Ajouter ")]),l("div",T,[l("table",q,[l("thead",P,[l("tr",null,[(s(!0),r(h,null,x(p.columns,t=>(s(),r("th",{key:t.key,class:"border px-4 py-2 text-left font-medium"},v(t.label),1))),128)),n[0]||(n[0]=l("th",{class:"border px-4 py-2 text-left font-medium"},"Actions",-1))])]),l("tbody",null,[(s(!0),r(h,null,x(a.value,(t,d)=>(s(),r("tr",{key:t.id??d,class:"hover:bg-gray-50"},[(s(!0),r(h,null,x(p.columns,o=>(s(),r("td",{key:o.key,class:"border px-4 py-2 align-top whitespace-nowrap"},[o.editable&&w(t)?(s(),r("div",Q,[o.type==="checkboxes"?(s(),r("div",z,[(s(!0),r(h,null,x(o.options,u=>(s(),r("label",{key:u.id,class:"block text-sm"},[C(l("input",{type:"checkbox",value:u.id,"onUpdate:modelValue":B=>a.value[d][o.bindKey]=B,class:"mr-1"},null,8,G),[[V,a.value[d][o.bindKey]]]),I(" "+v(u.label),1)]))),128))])):C((s(),r("input",{key:1,"onUpdate:modelValue":u=>a.value[d][o.key]=u,onBlur:u=>void 0,class:"border border-gray-300 rounded px-2 py-1 w-full"},null,40,H)),[[N,a.value[d][o.key]]])])):(s(),r("div",J,[o.type==="checkboxes"?(s(),r(h,{key:0},[I(v(A(t[o.bindKey],o.options)),1)],64)):U(e.$slots,o.key,{key:1,row:t},()=>[I(v(y(t[o.key],o.key)),1)],!0)]))]))),128)),l("td",W,[w(t)?(s(),r("div",ee,[l("button",{class:"text-green-600 hover:underline",onClick:o=>b(d)},"💾 Enregistrer",8,te),l("button",{class:"text-gray-600 hover:underline",onClick:o=>j(t)},"🔄 Annuler",8,ne)])):(s(),r("div",X,[l("button",{class:"text-blue-600 hover:underline",onClick:o=>S(t)},"✏️ Modifier",8,Y),t.id?(s(),r("button",{key:0,class:"text-red-600 hover:underline",onClick:o=>k(d)},"🗑️ Supprimer",8,Z)):D("",!0)]))])]))),128))])])])]))}},se=M(oe,[["__scopeId","data-v-2eda5ae2"]]),ie={__name:"UserSection",setup(p){const i=F(),a=K(()=>i.props.roles),m=[{key:"firstname",label:"Prénom",editable:!0},{key:"lastname",label:"Nom",editable:!0},{key:"email",label:"Email",editable:!0},{key:"langue",label:"Langue",editable:!0},{key:"role",label:"Rôle",editable:!0,type:"checkboxes",options:a.value.map(c=>({id:c.id,label:c.role})),bindKey:"selectedRoleIds"}],_={firstname:"",lastname:"",email:"",langue:"",selectedRoleIds:[],role:"-"};function f(c){var b,k;return{id:c.id,firstname:c.firstname,lastname:c.lastname,email:c.email,langue:c.langue,selectedRoleIds:((b=c.roles)==null?void 0:b.map(y=>y.id))??[],role:((k=c.roles)==null?void 0:k.map(y=>y.role).join(", "))||"-"}}return(c,b)=>(s(),L(se,{title:"Liste des utilisateurs",columns:m,resource:"users",defaultItem:_,formatItem:f}))}};export{ie as default};
