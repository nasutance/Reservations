import{f as n,o as s,r as D,l as I,b as i,t as p,d as P,F as C,k as M,m as g,g as V,v as z,p as N,q as k,Q as U,h as Q,j as $,a as w,c as R,w as A,e as B,u as j,s as G,x as E}from"./app-CLmhwZiQ.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as J}from"./DataTable-D1MpBSIu.js";const K={};function W(d,f){return s(),n("button",{class:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400",onClick:f[0]||(f[0]=v=>d.$emit("click"))},[D(d.$slots,"default")])}const X=H(K,[["render",W]]),Y={class:"fixed inset-0 bg-black/30 z-50 flex items-center justify-center"},Z={class:"bg-white p-6 rounded-xl shadow-md w-[400px] max-w-full"},ee={class:"text-lg font-bold mb-4"},te=["for"],se=["type","onUpdate:modelValue","id"],ne=["onUpdate:modelValue","id"],oe=["value"],le={class:"flex justify-end space-x-2"},ie={__name:"CreateModal",props:{entity:String,fields:Array,submitUrl:String},emits:["close"],setup(d,{emit:f}){const v=d,u={artist:"artiste",user:"utilisateur",reservation:"r√©servation"},_=f,c=I({});v.fields.forEach(m=>{c[m.name]=""});function b(){k.post(v.submitUrl,c,{preserveScroll:!0,onSuccess:()=>{_("close"),k.visit(route("dashboard"),{preserveScroll:!0})}})}return(m,r)=>(s(),n("div",Y,[i("div",Z,[i("h2",ee,"Cr√©er "+p(u[d.entity]||d.entity),1),i("form",{onSubmit:P(b,["prevent"])},[(s(!0),n(C,null,M(d.fields,e=>(s(),n("div",{key:e.name,class:"mb-4"},[i("label",{for:e.name,class:"block font-semibold mb-1"},p(e.label),9,te),e.type==="text"||e.type==="email"||e.type==="number"?g((s(),n("input",{key:0,type:e.type,"onUpdate:modelValue":l=>c[e.name]=l,id:e.name,class:"w-full border px-3 py-2 rounded"},null,8,se)),[[z,c[e.name]]]):e.type==="select"?g((s(),n("select",{key:1,"onUpdate:modelValue":l=>c[e.name]=l,id:e.name,class:"w-full border px-3 py-2 rounded"},[r[1]||(r[1]=i("option",{value:"",disabled:""},"-- Choisir --",-1)),(s(!0),n(C,null,M(e.options,l=>(s(),n("option",{key:l.value,value:l.value},p(l.label),9,oe))),128))],8,ne)),[[N,c[e.name]]]):V("",!0)]))),128)),i("div",le,[i("button",{type:"button",onClick:r[0]||(r[0]=e=>m.$emit("close")),class:"px-4 py-2 bg-gray-300 rounded"},"Annuler"),r[2]||(r[2]=i("button",{type:"submit",class:"px-4 py-2 bg-indigo-600 text-white rounded"},"Cr√©er",-1))])],32)])]))}},ae={reservation:[{name:"representation_id",label:"Repr√©sentation",type:"select",options:[],required:!0},{name:"price_id",label:"Tarif",type:"select",options:[],required:!0},{name:"quantity",label:"Quantit√©",type:"number",required:!0}],artist:[{name:"firstname",label:"Pr√©nom",type:"text",editOnly:!0},{name:"lastname",label:"Nom",type:"text",editOnly:!0}]};function re(){const d=U().props.artists??[],f=U().props.artistTypes??[];return{formattedArtists:Q(()=>d.map(u=>{var r;const _=f.filter(e=>e.artist_id===u.id),c=_.map(e=>{var l;return(l=e.type)==null?void 0:l.type}).filter(Boolean),b={};for(const e of _){const l=((r=e.type)==null?void 0:r.type)??"-";for(const T of e.shows??[])b[T.title]||(b[T.title]=[]),b[T.title].push(l)}const m=Object.entries(b).map(([e,l])=>`${e} (${l.join(", ")})`);return{id:u.id,firstname:u.firstname,lastname:u.lastname,fullname:`${u.firstname} ${u.lastname}`,typesText:c.join(", "),showsText:m.join(" / "),selectedTypeIds:_.map(e=>e.type_id),selectedShowTypeMap:Object.fromEntries(_.map(e=>[e.type_id,e.shows.map(l=>l.id)]))}}))}}const de={key:0},ue=["onUpdate:modelValue"],ce=["onUpdate:modelValue"],pe={key:1},me={key:0},ye=["value","onUpdate:modelValue"],fe={key:1},_e={key:0},be={class:"text-sm block"},ve=["onUpdate:modelValue"],he=["value"],xe={key:1},ke={class:"flex gap-2 items-center"},ge=["onClick"],Te=["onClick"],Se=["onClick"],$e={__name:"AdminArtistSection",setup(d){const{formattedArtists:f}=re(),v=U().props.types??[],u=U().props.shows??[];function _(o){var y;return((y=v.find(t=>t.id===o))==null?void 0:y.type)??`Type ${o}`}const c=["Artiste","Types","Spectacles","Actions"],b=["fullname","typesText","showsText","actions"],m=$(!1),r=$(null),e=$([]),l=$("");function T(o){r.value=o,e.value=ae[o],l.value="/artist",m.value=!0}function O(){m.value=!1,k.reload({preserveScroll:!0})}const S=$(new Set);function h(o){return S.value.has(o)}function q(o){h(o)?S.value.delete(o):S.value.add(o)}async function L(o){await k.put(`/artist/${o.id}`,{firstname:o.firstname,lastname:o.lastname,types:o.selectedTypeIds,shows:o.selectedShowTypeMap},{onSuccess:()=>{S.value.delete(o.id),k.reload({preserveScroll:!0})}})}function F(o){confirm("Supprimer d√©finitivement cet artiste ?")&&k.delete(`/artist/${o}`,{preserveScroll:!0,onSuccess:()=>{S.value.delete(o),k.reload({preserveScroll:!0})}})}return(o,y)=>(s(),n("div",null,[y[2]||(y[2]=i("h3",{class:"text-xl font-semibold mb-4"},"Liste des artistes",-1)),w(X,{onClick:y[0]||(y[0]=t=>T("artist"))},{default:A(()=>y[1]||(y[1]=[B("Cr√©er artiste")])),_:1}),w(J,{headers:c,fields:b,rows:j(f)},{fullname:A(({row:t})=>[h(t.id)?(s(),n("div",de,[g(i("input",{"onUpdate:modelValue":a=>t.firstname=a,placeholder:"Pr√©nom",class:"border px-2 py-1 rounded mr-1"},null,8,ue),[[E,t.firstname]]),g(i("input",{"onUpdate:modelValue":a=>t.lastname=a,placeholder:"Nom",class:"border px-2 py-1 rounded"},null,8,ce),[[E,t.lastname]])])):(s(),n("span",pe,p(t.fullname),1))]),typesText:A(({row:t})=>[h(t.id)?(s(),n("div",me,[(s(!0),n(C,null,M(j(v),a=>(s(),n("label",{key:a.id,class:"block text-sm"},[g(i("input",{type:"checkbox",value:a.id,"onUpdate:modelValue":x=>t.selectedTypeIds=x,class:"mr-1"},null,8,ye),[[G,t.selectedTypeIds]]),B(" "+p(a.type),1)]))),128))])):(s(),n("span",fe,p(t.typesText),1))]),showsText:A(({row:t})=>[h(t.id)?(s(),n("div",_e,[(s(!0),n(C,null,M(t.selectedTypeIds,a=>(s(),n("div",{key:a,class:"mb-2"},[i("strong",be,p(_(a)),1),g(i("select",{"onUpdate:modelValue":x=>t.selectedShowTypeMap[a]=x,multiple:"",class:"w-full border rounded px-2 py-1"},[(s(!0),n(C,null,M(j(u),x=>(s(),n("option",{key:x.id,value:x.id},p(x.title),9,he))),128))],8,ve),[[N,t.selectedShowTypeMap[a]]])]))),128))])):(s(),n("span",xe,p(t.showsText),1))]),actions:A(({row:t})=>[i("div",ke,[i("button",{onClick:a=>q(t.id),class:"text-sm text-blue-600"},p(h(t.id)?"Annuler":"‚úèÔ∏è Modifier"),9,ge),h(t.id)?(s(),n("button",{key:0,onClick:a=>L(t),class:"text-sm text-green-600"}," üíæ Enregistrer ",8,Te)):V("",!0),h(t.id)?(s(),n("button",{key:1,onClick:a=>F(t.id),class:"text-sm text-red-500 ml-2",title:"Supprimer l'artiste"}," ‚ùå ",8,Se)):V("",!0)])]),_:1},8,["rows"]),m.value?(s(),R(ie,{key:0,entity:r.value,fields:e.value,"submit-url":l.value,onClose:O},null,8,["entity","fields","submit-url"])):V("",!0)]))}},Ve=Object.freeze(Object.defineProperty({__proto__:null,default:$e},Symbol.toStringTag,{value:"Module"}));export{Ve as A,X as B,$e as _};
