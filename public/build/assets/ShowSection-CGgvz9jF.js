import{Q as h,h as N,j as g,f as o,o as i,b as l,g as D,t as c,r as E,a as y,w as f,F as k,l as x,u as S,m as C,e as F,s as M,p as O,q as R}from"./app-RXuUjciw.js";import{_ as T}from"./DataTable-CeC2OQm2.js";function U(){const b=h().props.shows??[],r=h().props.representations??[];return{formattedShows:N(()=>b.map(n=>{const _=r.filter(d=>d.show_id===n.id).map(d=>({...d,location:d.location||null}));return{id:n.id,title:n.title,description:n.description,duration:n.duration?`${n.duration} min`:"-",bookable:n.bookable?"Oui":"Non",representations:_}}))}}const q={key:0,class:"mt-2"},B={__name:"ToggleDetails",props:{openLabel:{type:String,default:"Voir détails"},closeLabel:{type:String,default:"Masquer"}},setup(b){const r=g(!1);function m(){r.value=!r.value}return(n,_)=>(i(),o("div",null,[l("button",{onClick:m,class:"p-2 rounded bg-blue-500 text-white hover:bg-blue-600 transition"},c(r.value?b.closeLabel:b.openLabel),1),r.value?(i(),o("div",q,[E(n.$slots,"default")])):D("",!0)]))}},P={key:0},A=["onUpdate:modelValue"],j={key:1},I={key:0,class:"flex flex-col gap-1"},Q=["value","onUpdate:modelValue"],z={key:1,class:"text-sm text-gray-700 list-disc pl-4 mb-1"},G={class:"pl-4 list-disc"},H={class:"flex gap-2"},J=["onClick"],K={key:1,class:"flex gap-2"},W=["onClick"],X=["onClick"],ee={__name:"ShowSection",setup(b){const{formattedShows:r}=U(),m=["Titre","Description","Durée","Réservable","Tarifs","Représentations","Actions"],n=["title","description","duration","bookable","prices","representations","actions"],_=h().props.prices??[],d=h().props.priceShow??[],u=g({}),p=g({});r.value.forEach(s=>{u.value[s.id]=d.filter(a=>a.show_id===s.id).map(a=>a.price_id)});function V(s){const a=d.filter(e=>e.show_id===s).map(e=>e.price_id);return _.filter(e=>a.includes(e.id))}function w(s){p.value[s]=!0,u.value[s]||(u.value[s]=[])}function $(s){p.value[s]=!1}function L(s){R.put(`/show/${s.id}`,{bookable:s.bookable,price_ids:u.value[s.id]},{onSuccess:()=>{p.value[s.id]=!1,window.location.reload()}})}return(s,a)=>(i(),o("div",null,[a[1]||(a[1]=l("h3",{class:"text-xl font-semibold mb-4"},"Liste des spectacles",-1)),y(T,{headers:m,fields:n,rows:S(r)},{bookable:f(({row:e})=>[p.value[e.id]?(i(),o("div",P,[C(l("select",{"onUpdate:modelValue":t=>e.bookable=t,class:"border px-2 py-1 rounded text-sm"},a[0]||(a[0]=[l("option",{value:!0},"Oui",-1),l("option",{value:!1},"Non",-1)]),8,A),[[O,e.bookable]])])):(i(),o("span",j,c(e.bookable?"Oui":"Non"),1))]),prices:f(({row:e})=>[p.value[e.id]?(i(),o("div",I,[(i(!0),o(k,null,x(S(_),t=>(i(),o("label",{key:t.id,class:"flex items-center gap-2 text-sm"},[C(l("input",{type:"checkbox",value:t.id,"onUpdate:modelValue":v=>u.value[e.id]=v,class:"accent-blue-600"},null,8,Q),[[M,u.value[e.id]]]),F(" "+c(t.description)+" — "+c(t.price)+"€ ",1)]))),128))])):(i(),o("ul",z,[(i(!0),o(k,null,x(V(e.id),t=>(i(),o("li",{key:t.id},c(t.description)+" — "+c(t.price)+"€ ",1))),128))]))]),representations:f(({row:e})=>[y(B,{openLabel:"Voir représentations",closeLabel:"Masquer représentations"},{default:f(()=>[l("ul",G,[(i(!0),o(k,null,x(e.representations,t=>{var v;return i(),o("li",{key:t.id}," 📅 "+c(t.schedule)+" — 📍 "+c(((v=t.location)==null?void 0:v.designation)||"-"),1)}),128))])]),_:2},1024)]),actions:f(({row:e})=>[l("div",H,[p.value[e.id]?(i(),o("div",K,[l("button",{class:"bg-green-600 text-white text-sm px-2 py-1 rounded",onClick:t=>L(e)}," 💾 Enregistrer ",8,W),l("button",{class:"bg-gray-300 text-gray-800 text-sm px-2 py-1 rounded",onClick:t=>$(e.id)}," ❌ Annuler ",8,X)])):(i(),o("button",{key:0,class:"text-blue-600 text-sm hover:underline",onClick:t=>w(e.id)}," ✏️ Modifier ",8,J))])]),_:1},8,["rows"])]))}};export{ee as default};
