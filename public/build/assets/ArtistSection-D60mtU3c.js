import{f as n,o as s,r as F,k as I,b as a,t as p,d as P,F as A,l as M,m as g,g as V,v as z,p as N,q as k,Q as U,h as Q,j as $,a as w,c as R,w as C,e as B,u as j,s as G,x as E}from"./app-pR54vJex.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as J}from"./DataTable-dhz1t69T.js";const K={};function W(d,f){return s(),n("button",{class:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400",onClick:f[0]||(f[0]=v=>d.$emit("click"))},[F(d.$slots,"default")])}const X=H(K,[["render",W]]),Y={class:"fixed inset-0 bg-black/30 z-50 flex items-center justify-center"},Z={class:"bg-white p-6 rounded-xl shadow-md w-[400px] max-w-full"},ee={class:"text-lg font-bold mb-4"},te=["for"],se=["type","onUpdate:modelValue","id"],ne=["onUpdate:modelValue","id"],oe=["value"],le={class:"flex justify-end space-x-2"},ae={__name:"CreateModal",props:{entity:String,fields:Array,submitUrl:String},emits:["close"],setup(d,{emit:f}){const v=d,u={artist:"artiste",user:"utilisateur",reservation:"r√©servation"},b=f,c=I({});v.fields.forEach(m=>{c[m.name]=""});function _(){k.post(v.submitUrl,c,{preserveScroll:!0,onSuccess:()=>{b("close"),k.visit(route("dashboard"),{preserveScroll:!0})}})}return(m,r)=>(s(),n("div",Y,[a("div",Z,[a("h2",ee,"Cr√©er "+p(u[d.entity]||d.entity),1),a("form",{onSubmit:P(_,["prevent"])},[(s(!0),n(A,null,M(d.fields,e=>(s(),n("div",{key:e.name,class:"mb-4"},[a("label",{for:e.name,class:"block font-semibold mb-1"},p(e.label),9,te),e.type==="text"||e.type==="email"||e.type==="number"?g((s(),n("input",{key:0,type:e.type,"onUpdate:modelValue":l=>c[e.name]=l,id:e.name,class:"w-full border px-3 py-2 rounded"},null,8,se)),[[z,c[e.name]]]):e.type==="select"?g((s(),n("select",{key:1,"onUpdate:modelValue":l=>c[e.name]=l,id:e.name,class:"w-full border px-3 py-2 rounded"},[r[1]||(r[1]=a("option",{value:"",disabled:""},"-- Choisir --",-1)),(s(!0),n(A,null,M(e.options,l=>(s(),n("option",{key:l.value,value:l.value},p(l.label),9,oe))),128))],8,ne)),[[N,c[e.name]]]):V("",!0)]))),128)),a("div",le,[a("button",{type:"button",onClick:r[0]||(r[0]=e=>m.$emit("close")),class:"px-4 py-2 bg-gray-300 rounded"},"Annuler"),r[2]||(r[2]=a("button",{type:"submit",class:"px-4 py-2 bg-indigo-600 text-white rounded"},"Cr√©er",-1))])],32)])]))}},ie={reservation:[{name:"representation_id",label:"Repr√©sentation",type:"select",options:[],required:!0},{name:"price_id",label:"Tarif",type:"select",options:[],required:!0},{name:"quantity",label:"Quantit√©",type:"number",required:!0}],artist:[{name:"firstname",label:"Pr√©nom",type:"text",editOnly:!0},{name:"lastname",label:"Nom",type:"text",editOnly:!0}],price:[{name:"type",label:"Libell√©",type:"text"},{name:"description",label:"Description",type:"text"},{name:"price",label:"Montant",type:"number"},{name:"start_date",label:"D√©but",type:"date"},{name:"end_date",label:"Fin",type:"date"}]};function re(){const d=U().props.artists??[],f=U().props.artistTypes??[];return{formattedArtists:Q(()=>d.map(u=>{var r;const b=f.filter(e=>e.artist_id===u.id),c=b.map(e=>{var l;return(l=e.type)==null?void 0:l.type}).filter(Boolean),_={};for(const e of b){const l=((r=e.type)==null?void 0:r.type)??"-";for(const T of e.shows??[])_[T.title]||(_[T.title]=[]),_[T.title].push(l)}const m=Object.entries(_).map(([e,l])=>`${e} (${l.join(", ")})`);return{id:u.id,firstname:u.firstname,lastname:u.lastname,fullname:`${u.firstname} ${u.lastname}`,typesText:c.join(", "),showsText:m.join(" / "),selectedTypeIds:b.map(e=>e.type_id),selectedShowTypeMap:Object.fromEntries(b.map(e=>[e.type_id,e.shows.map(l=>l.id)]))}}))}}const de={key:0},ue=["onUpdate:modelValue"],ce=["onUpdate:modelValue"],pe={key:1},me={key:0},ye=["value","onUpdate:modelValue"],fe={key:1},be={key:0},_e={class:"text-sm block"},ve=["onUpdate:modelValue"],he=["value"],xe={key:1},ke={class:"flex gap-2 items-center"},ge=["onClick"],Te=["onClick"],Se=["onClick"],$e={__name:"ArtistSection",setup(d){const{formattedArtists:f}=re(),v=U().props.types??[],u=U().props.shows??[];function b(o){var y;return((y=v.find(t=>t.id===o))==null?void 0:y.type)??`Type ${o}`}const c=["Artiste","Types","Spectacles","Actions"],_=["fullname","typesText","showsText","actions"],m=$(!1),r=$(null),e=$([]),l=$("");function T(o){r.value=o,e.value=ie[o],l.value="/artist",m.value=!0}function L(){m.value=!1,k.reload({preserveScroll:!0})}const S=$(new Set);function h(o){return S.value.has(o)}function O(o){h(o)?S.value.delete(o):S.value.add(o)}async function q(o){await k.put(`/artist/${o.id}`,{firstname:o.firstname,lastname:o.lastname,types:o.selectedTypeIds,shows:o.selectedShowTypeMap},{onSuccess:()=>{S.value.delete(o.id),k.reload({preserveScroll:!0})}})}function D(o){confirm("Supprimer d√©finitivement cet artiste ?")&&k.delete(`/artist/${o}`,{preserveScroll:!0,onSuccess:()=>{S.value.delete(o),k.reload({preserveScroll:!0})}})}return(o,y)=>(s(),n("div",null,[y[2]||(y[2]=a("h3",{class:"text-xl font-semibold mb-4"},"Liste des artistes",-1)),w(X,{onClick:y[0]||(y[0]=t=>T("artist"))},{default:C(()=>y[1]||(y[1]=[B("Cr√©er artiste")])),_:1}),w(J,{headers:c,fields:_,rows:j(f)},{fullname:C(({row:t})=>[h(t.id)?(s(),n("div",de,[g(a("input",{"onUpdate:modelValue":i=>t.firstname=i,placeholder:"Pr√©nom",class:"border px-2 py-1 rounded mr-1"},null,8,ue),[[E,t.firstname]]),g(a("input",{"onUpdate:modelValue":i=>t.lastname=i,placeholder:"Nom",class:"border px-2 py-1 rounded"},null,8,ce),[[E,t.lastname]])])):(s(),n("span",pe,p(t.fullname),1))]),typesText:C(({row:t})=>[h(t.id)?(s(),n("div",me,[(s(!0),n(A,null,M(j(v),i=>(s(),n("label",{key:i.id,class:"block text-sm"},[g(a("input",{type:"checkbox",value:i.id,"onUpdate:modelValue":x=>t.selectedTypeIds=x,class:"mr-1"},null,8,ye),[[G,t.selectedTypeIds]]),B(" "+p(i.type),1)]))),128))])):(s(),n("span",fe,p(t.typesText),1))]),showsText:C(({row:t})=>[h(t.id)?(s(),n("div",be,[(s(!0),n(A,null,M(t.selectedTypeIds,i=>(s(),n("div",{key:i,class:"mb-2"},[a("strong",_e,p(b(i)),1),g(a("select",{"onUpdate:modelValue":x=>t.selectedShowTypeMap[i]=x,multiple:"",class:"w-full border rounded px-2 py-1"},[(s(!0),n(A,null,M(j(u),x=>(s(),n("option",{key:x.id,value:x.id},p(x.title),9,he))),128))],8,ve),[[N,t.selectedShowTypeMap[i]]])]))),128))])):(s(),n("span",xe,p(t.showsText),1))]),actions:C(({row:t})=>[a("div",ke,[a("button",{onClick:i=>O(t.id),class:"text-sm text-blue-600"},p(h(t.id)?"Annuler":"‚úèÔ∏è Modifier"),9,ge),h(t.id)?(s(),n("button",{key:0,onClick:i=>q(t),class:"text-sm text-green-600"}," üíæ Enregistrer ",8,Te)):V("",!0),h(t.id)?(s(),n("button",{key:1,onClick:i=>D(t.id),class:"text-sm text-red-500 ml-2",title:"Supprimer l'artiste"}," ‚ùå ",8,Se)):V("",!0)])]),_:1},8,["rows"]),m.value?(s(),R(ae,{key:0,entity:r.value,fields:e.value,"submit-url":l.value,onClose:L},null,8,["entity","fields","submit-url"])):V("",!0)]))}},Ve=Object.freeze(Object.defineProperty({__proto__:null,default:$e},Symbol.toStringTag,{value:"Module"}));export{Ve as A,X as B,$e as _};
