import{Q as R,j as r,k as U,f as s,o,b as u,a as D,w as _,F as v,g as E,m as f,l as w,t as p,s as b,p as L,u as A,q as h}from"./app-BMjlmMSH.js";import{f as B}from"./formatDate-D984MnE_.js";import{_ as F}from"./DataTable-B0UdSOJv.js";const M=["onUpdate:modelValue"],j={key:1},q=["onUpdate:modelValue"],H=["value"],I={key:1},Q=["onUpdate:modelValue"],T=["value"],z={key:1},G={class:"flex flex-col gap-2 items-start mt-1"},J=["onClick"],K=["onClick"],O=["onClick"],P=["onClick"],ee={__name:"RepresentationSection",setup(W){const d=R(),k=r(d.props.locations??[]),x=r(d.props.shows??[]);r(d.props.representations??[]);const m=r([]),a=r(new Set);y(),U(()=>d.props.representations,y);function y(){const t=d.props.representations??[];m.value=t.map(n=>({...n,location_id:n.location_id,show_id:n.show_id}))}function c(t){return a.value.has(t)}function g(t){c(t)?a.value.delete(t):a.value.add(t)}function S(){var n,e;const t={id:`new-${Date.now()}`,schedule:"",location_id:((n=k.value[0])==null?void 0:n.id)??null,show_id:((e=x.value[0])==null?void 0:e.id)??null,isNew:!0};m.value.unshift(t),a.value.add(t.id)}function C(t){const n=t.isNew?"post":"put",e=t.isNew?"/representation":`/representation/${t.id}`;h[n](e,{schedule:t.schedule,location_id:t.location_id,show_id:t.show_id},{onSuccess:()=>{a.value.delete(t.id),h.reload({preserveScroll:!0})}})}function V(t){confirm("Supprimer définitivement cette représentation ?")&&h.delete(`/representation/${t}`,{preserveScroll:!0,onSuccess:()=>{a.value.delete(t),h.reload({preserveScroll:!0})}})}const N=["Date & Heure","Lieu","Spectacle","Actions"],$=["schedule","location","show","actions"];return(t,n)=>(o(),s("div",null,[n[0]||(n[0]=u("h3",{class:"text-xl font-semibold mb-4"},"Liste des représentations",-1)),u("button",{onClick:S},"➕ Ajouter une représentation"),D(F,{headers:N,fields:$,rows:m.value},{schedule:_(({row:e})=>[c(e.id)?f((o(),s("input",{key:0,type:"datetime-local","onUpdate:modelValue":i=>e.schedule=i,class:"border px-2 py-1 rounded w-full"},null,8,M)),[[L,e.schedule]]):(o(),s("span",j,p(A(B)(e.schedule,{time:!0})),1))]),location:_(({row:e})=>{var i;return[c(e.id)?f((o(),s("select",{key:0,"onUpdate:modelValue":l=>e.location_id=l,class:"border px-2 py-1 rounded w-full"},[(o(!0),s(v,null,w(k.value,l=>(o(),s("option",{key:l.id,value:l.id},p(l.designation),9,H))),128))],8,q)),[[b,e.location_id]]):(o(),s("span",I,p(((i=e.location)==null?void 0:i.designation)??"—"),1))]}),show:_(({row:e})=>{var i;return[c(e.id)?f((o(),s("select",{key:0,"onUpdate:modelValue":l=>e.show_id=l,class:"border px-2 py-1 rounded w-full"},[(o(!0),s(v,null,w(x.value,l=>(o(),s("option",{key:l.id,value:l.id},p(l.title),9,T))),128))],8,Q)),[[b,e.show_id]]):(o(),s("span",z,p(((i=e.show)==null?void 0:i.title)??"—"),1))]}),actions:_(({row:e})=>[u("div",G,[c(e.id)?(o(),s(v,{key:1},[u("button",{class:"text-green-600 text-sm hover:underline",onClick:i=>C(e)}," 💾 Enregistrer ",8,K),u("button",{class:"text-gray-600 text-sm hover:underline",onClick:i=>g(e.id)}," 🔄 Annuler ",8,O),e.isNew?E("",!0):(o(),s("button",{key:0,class:"text-red-600 text-sm hover:underline",onClick:i=>V(e.id)}," 🗑️ Supprimer ",8,P))],64)):(o(),s("button",{key:0,class:"text-blue-600 text-sm hover:underline",onClick:i=>g(e.id)}," ✏️ Modifier ",8,J))])]),_:1},8,["rows"])]))}};export{ee as default};
