import{Q as g,h as C,j as $,f as s,o as l,b as m,a as E,w as d,g as x,t as i,F as I,k as N,u as U,m as c,e as R,s as F,x as p,q as _}from"./app-CLmhwZiQ.js";import{_ as A}from"./DataTable-D1MpBSIu.js";function B(){const f=g().props.users??[];return{formattedUsers:C(()=>f.map(a=>({id:a.id,firstname:a.firstname,lastname:a.lastname,email:a.email,langue:a.langue,role:a.roles.length>0?a.roles.map(r=>r.role).join(", "):"-",selectedRoleIds:a.roles.map(r=>r.id)})))}}const L=["onUpdate:modelValue"],M={key:1},j=["onUpdate:modelValue"],D={key:1},T=["onUpdate:modelValue"],q={key:1},P=["onUpdate:modelValue"],Q={key:1},z={key:0},G=["value","onUpdate:modelValue"],H={key:1},J={class:"flex gap-2 items-center"},K=["onClick"],O=["onClick"],W=["onClick"],Z={__name:"AdminUserSection",setup(f){const k=g().props.roles??[],{formattedUsers:a}=B(),r=["Prénom","Nom","Email","Langue","Rôle","Actions"],v=["firstname","lastname","email","langue","role","actions"],u=$(new Set);function o(t){return u.value.has(t)}function y(t){o(t)?u.value.delete(t):u.value.add(t)}function b(t){_.put(`/users/${t.id}`,{firstname:t.firstname,lastname:t.lastname,email:t.email,langue:t.langue,roles:t.selectedRoleIds},{onSuccess:()=>{u.value.delete(t.id),_.reload({preserveScroll:!0})}})}function V(t){confirm("Supprimer définitivement cet utilisateur ?")&&_.delete(`/users/${t}`,{preserveScroll:!0,onSuccess:()=>{u.value.delete(t),_.reload({preserveScroll:!0})}})}return(t,h)=>(l(),s("div",null,[h[0]||(h[0]=m("h3",{class:"text-xl font-semibold mb-4"},"Liste des utilisateurs",-1)),E(A,{headers:r,fields:v,rows:U(a)},{firstname:d(({row:e})=>[o(e.id)?c((l(),s("input",{key:0,"onUpdate:modelValue":n=>e.firstname=n,class:"border px-2 py-1 rounded w-full"},null,8,L)),[[p,e.firstname]]):(l(),s("span",M,i(e.firstname),1))]),lastname:d(({row:e})=>[o(e.id)?c((l(),s("input",{key:0,"onUpdate:modelValue":n=>e.lastname=n,class:"border px-2 py-1 rounded w-full"},null,8,j)),[[p,e.lastname]]):(l(),s("span",D,i(e.lastname),1))]),email:d(({row:e})=>[o(e.id)?c((l(),s("input",{key:0,"onUpdate:modelValue":n=>e.email=n,class:"border px-2 py-1 rounded w-full"},null,8,T)),[[p,e.email]]):(l(),s("span",q,i(e.email),1))]),langue:d(({row:e})=>[o(e.id)?c((l(),s("input",{key:0,"onUpdate:modelValue":n=>e.langue=n,class:"border px-2 py-1 rounded w-full"},null,8,P)),[[p,e.langue]]):(l(),s("span",Q,i(e.langue),1))]),role:d(({row:e})=>[o(e.id)?(l(),s("div",z,[(l(!0),s(I,null,N(U(k),n=>(l(),s("label",{key:n.id,class:"block text-sm"},[c(m("input",{type:"checkbox",value:n.id,"onUpdate:modelValue":S=>e.selectedRoleIds=S,class:"mr-1"},null,8,G),[[F,e.selectedRoleIds]]),R(" "+i(n.role),1)]))),128))])):(l(),s("span",H,i(e.role),1))]),actions:d(({row:e})=>[m("div",J,[m("button",{onClick:n=>y(e.id),class:"text-sm text-blue-600"},i(o(e.id)?"Annuler":"✏️ Modifier"),9,K),o(e.id)?(l(),s("button",{key:0,onClick:n=>b(e),class:"text-sm text-green-600"}," 💾 Enregistrer ",8,O)):x("",!0),o(e.id)?(l(),s("button",{key:1,onClick:n=>V(e.id),class:"text-sm text-red-500 ml-2",title:"Supprimer l’utilisateur"}," ❌ ",8,W)):x("",!0)])]),_:1},8,["rows"])]))}};export{Z as default};
